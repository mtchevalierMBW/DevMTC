<!--
* 2017-02-28	B. Leaman	BLL8 Changes in record types for commercial proposals.
* 2017-07-18	B. Leaman	BLL10 - Adjust for long billing name causing extra wrap-around using
*							too much vertical space.
* 2017-09-06	B. Leaman	BLL14 - Split License fee & Registration/Title fee; IR-0018049 exterior color
* 2018-11-28    J. Pritt    JRP01 - Add form ID Barcode
* 2019-03-13    J. Pritt    JRP02  - Append SSLast4 to name
* 2019-04-16	B. Leaman	W-000651 BLL18 - use proposal date for "Date" field.
*							Reworked to use delivery date if it's filled in, otherwise use proposal date. 4/26/2019
-->
<apex:page renderAs="pdf" applyHtmlTag="false" showHeader="false" showChat="false" standardStylesheets="false" standardController="dealer__Deal__c" extensions="Deal_MBW2">
<html>
<!-- 
	2017-02-13	B. Leaman 	Replace Service_Vehicle__c with dealer__Service_Vehicle__c.
 -->
<head>
    <title>Solution Proposal</title>
    <style>

        @page {
          size:portrait;
          <!-- margin: 0.25in 0.5in .35in; JRP01 -->
           margin: .1in;  <!-- JRP01 -->
           @bottom-left {
                content: "Prepared by MobilityWorks";
                font-size: .85em;
            }
        }

        strong {
            font-weight: bold;
        }

        body {
            font-family: sans-serif;
            font-size: 12px;
            max-width: 900px;
        }

        .main_logo {
            float: left;
            height: 50px;
            width: auto;
            margin-right: 15px; 
        }

        table {
            border-color: #666;
            border-width: 0;
            border-spacing: 0;
        }

        td {
            border-color: #666;
            /*border-width: 0;*/
        }

        .header_data {
            font-size: .9em;
        }

        .header_data td:first-child, em {
            color: #666;
        }

        .header_data td:last-child {
            font-weight: bold;
        }

        .header_data td {
            padding: 2px;
        }

        .calc_table {
            border: 1px #666 solid;
        }

        .calc_table td, .equip_table td, .equip_table th {
            border-width: 1px;
            border-color: #666;
            border-style: solid;
        }


        .calc_table td {
            border-top-width: 0;
            border-right-width: 0;
        }

        .calc_table td:first-child {
            border-left-width: 0;
        }

        .calc_header td, .calc_body td {
            padding: 2px 4px;

        }

        .calc_body td {
            font-size: .9em;
        }

        .calc_body td.border_left, .border_left {
            border-left: 1px solid #666;
        }

        .equip_table th {
            border: 0;
            border-bottom: 1px solid #666;
        }

        .equip_table th h2 {
            margin: 3px;
        }

        .equip_table td {
            padding: 5px;
        }

        .lines {
            line-height: 1.3em;
            padding: 5px 5px;
        }

        .center {
            text-align: 
        }

        .text_right {
            text-align: right;
        }

        .disclaimer {
            font-size: .75em;
            color: #333;
            padding: 0 20px;
            text-align: center;
        }

        h1 {
            margin: .5em 0 .5em;
        }

        h1 small {
          display: block;
          font-size: .6em;
          font-weight: 400;
          color: #777;
        }

        hr {
            border: 0;
            border-bottom: 1px solid #777;
        }

        #page2 {
            page-break-before : always;
            break-before : always;
        }
    </style>
</head>

<body>
    <div id="page1">
    <apex:image value="https://chart.googleapis.com/chart?cht=qr&chs=50x50&chl=Proposal&chld=L|0" style="float:left;"/><!-- JRP01 -->
        <table cellpadding="0" cellspacing="0" align="center" width="95%" style="padding:15px; padding-top:30px;">
            <tr>
                <td width="50%">
                    <apex:image value="{!$Resource.FormLogo}" styleClass="main_logo" />
                    <h1>
                        Proposal&nbsp;<small>Proposal&nbsp;#:<apex:outputText value="{!dealer__Deal__c.Name}" /></small>
                    </h1>
                </td>
                <td align="right">
                    <!-- Location Block -->
                    <table cellpadding="0" cellspacing="0" width="100%">
                        <tr>
                            <td><b><apex:outputText value="{!IF(ISBLANK(location.Dealer_License_Name__c), 'Mobility Works of '+location.Name, location.Dealer_License_Name__c)}" /></b></td>
                        </tr>
                        <tr>
                            <td>
                                <apex:outputField value="{!location.dealer__Street__c}" /><br />
                                <apex:outputField value="{!location.dealer__City__c}" />,&nbsp;
                                <apex:outputField value="{!location.dealer__State__c}" />&nbsp;
                                <apex:outputField value="{!location.dealer__Postal_Code__c}" /><br />
                                <apex:outputField value="{!location.dealer__Main_Phone__c}" />
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <!--tr>
                <td>{!cmc.FirstName}&nbsp;{!cmc.LastName}&nbsp;&nbsp;Email:&nbsp;{!cmc.Email}&nbsp;&nbsp;Phone:&nbsp;{!cmc.Phone}&nbsp;&nbsp;Mobile:&nbsp;{!cmc.MobilePhone}</td>
            </tr-->
            <tr>
                <td colspan="2">{!dealer__Deal__c.dealer__Salesperson_1__r.Name}&nbsp;&nbsp;Email:&nbsp;{!dealer__Deal__c.dealer__Salesperson_1__r.Email}&nbsp;&nbsp;Phone:&nbsp;{!dealer__Deal__c.dealer__Salesperson_1__r.Phone}&nbsp;&nbsp;Mobile:&nbsp;{!dealer__Deal__c.dealer__Salesperson_1__r.MobilePhone}</td>
            </tr>
        </table>
        <hr />
        <table width="100%">
            <tr valign="top">
                <td>
                    <table class="header_data" cellpadding="0" cellspacing="0">
                        <tr>
                            <td class="text_right" >Billing Name&nbsp;</td>
                            <td>
                                <strong>
                                    <apex:outputText value="{!IF(  NOT(ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c))  , dealer__Deal__c.Third_Party_Pay_1__r.Name, dealer__Deal__c.dealer__Buyer__r.Name)}" />
                                </strong>
                                
                                <!-- JRP02 begin -->
                               <apex:outputPanel rendered="{!AND (NOT(ISBLANK(dealer__Deal__c.dealer__Buyer__r.SSLast4__pc)) ,
                                  ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c))}" layout="none">                    
                               &nbsp;&nbsp;#<apex:outputField value="{!dealer__Deal__c.dealer__Buyer__r.SSLast4__pc}"  />
                               </apex:outputPanel>
                               <!-- JRP02 end -->
                                
                            </td>
                        </tr>
                        <apex:outputPanel rendered="{!NOT(ISBLANK(dealer__Deal__c.dealer__Co_Buyer__c))}" layout="none">  
                        <tr>
                            <td class="text_right" >Co-Buyer&nbsp;</td>
                            <td>
                                <strong>
                                    <apex:outputText value="{!dealer__Deal__c.dealer__Co_Buyer__r.Name}" />
                                </strong>
                            </td>
                        </tr>
                        </apex:outputPanel>
                        <tr>
                            <td class="text_right" >Address&nbsp;</td>
                            <td>
                                <apex:outputText value="{!IF(  NOT(ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c))  , dealer__Deal__c.Third_Party_Pay_1__r.BillingStreet , dealer__Deal__c.dealer__Buyer_Address__c )}" />
                            </td>
                        </tr>
                        <tr>
                            <td class="text_right" >City,&nbsp;State&nbsp;ZIP&nbsp;</td>
                            <td>
                                <apex:outputText value="{0},{1} {2}" rendered="{!ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c)}">
                                    <apex:param value="{!dealer__Deal__c.dealer__Buyer_City__c}"/>
                                    <apex:param value="{!dealer__Deal__c.dealer__Buyer_State__c}"/>
                                    <apex:param value="{!dealer__Deal__c.dealer__Buyer_Postal_Code__c}"/>
                                </apex:outputText>

                                <apex:outputText value="{0},{1} {2}" rendered="{!NOT(ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c))}">
                                    <apex:param value="{!dealer__Deal__c.Third_Party_Pay_1__r.BillingCity}"/>
                                    <apex:param value="{!dealer__Deal__c.Third_Party_Pay_1__r.BillingState}"/>
                                    <apex:param value="{!dealer__Deal__c.Third_Party_Pay_1__r.BillingPostalCode}"/>
                                </apex:outputText>
                            </td>
                        </tr>
                        <apex:outputPanel rendered="{!and(NOT(ISBLANK(dealer__Deal__c.dealer__Buyer_County__c)),
                            ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c))}" layout="none">  
                        <tr>
                            <td class="text_right" >County&nbsp;</td>
                            <td> 
                                <apex:outputText value="{!dealer__Deal__c.dealer__Buyer_County__c}" />                            
                            </td>
                        </tr>
                        </apex:outputPanel>

                        <apex:outputPanel rendered="{!and(NOT(ISBLANK(dealer__Deal__c.dealer__Buyer_Home_Phone__c)),
                            ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c))}" layout="none">
                        <tr>
                            <td class="text_right" >Home&nbsp;Phone&nbsp;</td>
                            <td><apex:outputText value="{!dealer__Deal__c.dealer__Buyer_Home_Phone__c}" /></td>
                        </tr>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!and(NOT(ISBLANK(dealer__Deal__c.dealer__Buyer_Mobile_Phone__c)),
                           ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c))}" layout="none">                  
                        <tr>
                            <td class="text_right" >Mobile&nbsp;Phone&nbsp;</td>
                            <td><apex:outputText value="{!dealer__Deal__c.dealer__Buyer_Mobile_Phone__c}" /></td>
                        </tr>
                        </apex:outputPanel>

                        <apex:outputPanel rendered="{!and(NOT(ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c)),
                          NOT(ISBLANK(dealer__Deal__c.Third_Party_Pay_1__r.Phone)))}" layout="none">                  
                        <tr>
                            <td class="text_right" >Phone&nbsp;</td>
                            <td><apex:outputText value="{!dealer__Deal__c.Third_Party_Pay_1__r.Phone}" /></td>
                        </tr>
                        </apex:outputPanel>  
                        <apex:outputPanel rendered="{!and(NOT(ISBLANK(dealer__Deal__c.Third_Party_Pay_1__c)),
                            NOT(ISBLANK(dealer__Deal__c.Third_Party_Pay_1__r.Fax)))}" layout="none">                  
                        <tr>
                            <td class="text_right" >Fax&nbsp;</td>
                            <td><apex:outputField value="{!dealer__Deal__c.Third_Party_Pay_1__r.Fax}" /></td>
                        </tr>
                        </apex:outputPanel>            
                    </table>
                </td>
                <td>
                    <table class="header_data" cellpadding="0px" cellspacing="0" >
                        <tr>
                            <td class="text_right" >User Name&nbsp;</td>
                            <td><apex:outputText value="{!dealer__Deal__c.dealer__Buyer__r.Name}" />
                            
                               <!-- JRP02 begin -->
                               <apex:outputPanel rendered="{!NOT(ISBLANK(dealer__Deal__c.dealer__Buyer__r.SSLast4__pc))}" layout="none">                    
                               &nbsp;&nbsp;#<apex:outputField value="{!dealer__Deal__c.dealer__Buyer__r.SSLast4__pc}"  />
                               </apex:outputPanel>
                               <!-- JRP02 end -->
                            
                            </td>
                        </tr>
                        <tr>
                            <td class="text_right" >Address&nbsp;</td>
                            <td><apex:outputText value="{!dealer__Deal__c.dealer__Buyer_Address__c}" /></td>
                        </tr>
                        <tr>
                            <td class="text_right" >City,&nbsp;State&nbsp;ZIP&nbsp;</td>
                            <td>
                                <apex:outputText value="{0},{1} {2}" >
                                    <apex:param value="{!dealer__Deal__c.dealer__Buyer_City__c}"/>
                                    <apex:param value="{!dealer__Deal__c.dealer__Buyer_State__c}"/>
                                    <apex:param value="{!dealer__Deal__c.dealer__Buyer_Postal_Code__c}"/>
                                </apex:outputText>
                            </td>
                        </tr>
                        <tr>
                            <td class="text_right" >County&nbsp;</td>
                            <td><apex:outputText value="{!dealer__Deal__c.dealer__Buyer_County__c}"  /></td>
                        </tr>

                        <apex:outputPanel rendered="{!NOT(ISBLANK(dealer__Deal__c.dealer__Buyer_Home_Phone__c))}" layout="none">                    
                            <tr>
                                <td class="text_right" >Home&nbsp;Phone&nbsp;</td>
                                <td><apex:outputField value="{!dealer__Deal__c.dealer__Buyer_Home_Phone__c}"  /></td>
                            </tr>                
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!NOT(ISBLANK(dealer__Deal__c.dealer__Buyer_Mobile_Phone__c))}" layout="none">                                        
                        <tr>
                            <td class="text_right" >Mobile&nbsp;Phone&nbsp;</td>
                            <td><apex:outputField value="{!dealer__Deal__c.dealer__Buyer_Mobile_Phone__c}" /></td>
                        </tr>
                        </apex:outputPanel>                    
                    </table>
                </td>
                <td>
                    <table class="header_data" cellpadding="0px" cellspacing="0" >
                        <tr>
                            <td class="text_right" >Stock #&nbsp;</td>
                            <td><apex:outputText value="{!dealer__Deal__c.dealer__Stock_Number__c}" /></td>
                        </tr>
                        <tr>
                            <td class="text_right" >Invoice #&nbsp;</td>
                            <td> <apex:outputText value="{!dealer__Deal__c.Name}" /> </td>
                        </tr>
                        <tr>
                            <td class="text_right" >Date&nbsp;</td>
                            <td>
                                <apex:OutputText value="{0, date, MM'/'dd'/'yyyy}">
									<!--BLL18-->
									<!-- apex:param value="{!dealer__Deal__c.Proposed_Delivery_Date__c}" /-->
									<apex:param value="{!BLANKVALUE(dealer__Deal__c.Proposed_Delivery_Date__c,dealer__Deal__c.dealer__Deal_Date__c)}" />
									<!--BLL18-->
                                </apex:OutputText>
                            </td>
                        </tr>
                        <tr>
                            <td class="text_right" ></td>
                            <td></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
            <!--
         <table style="padding:0px 0px 0px 0px;" width="100%">
            <tr>
                <td>
                <table style="font-size:0.7em; " cellspacing="0" cellpadding="0">
                    <tr>
                        <td align="right"><em>Billing Name</em></td><td></td>
                    </tr>
                    <tr>
                        <td align="right"><em>Co-Buyer</em></td><td></td>
                    </tr>
                    <tr>
                        <td align="right"><em>Addres</em></td><td><strong>1435 Cincinnati Street</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>City,&nbsp;State&nbsp;ZIP</em></td><td><strong>Dayton, OH 45417</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>County</em></td><td></td>
                    </tr>
                    <tr>
                        <td align="right"><em>Phone</em></td><td></td>
                    </tr>
                </table>
                </td>
                <td>
                <table style="font-size:0.7em; " cellspacing="0" cellpadding="0px">
                    <tr>
                        <td align="right"><em>User Name</em></td><td><strong>DAVID C. IMBER</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>Address</em></td><td><strong>8651 Sea Pines Ln</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>City,&nbsp;State&nbsp;ZIP</em></td><td><strong>Centerville, OH 45458-3321</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>County</em></td><td><strong>Montgomery</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>Phone</em></td><td><strong>(937)474-7113</strong></td>
                    </tr>
                </table>
                </td>
                <td>
                <table style="font-size:0.7em; " cellspacing="0" cellpadding="0px">
                    <tr>
                        <td align="right"><em>Stock #</em></td><td align="left"><strong>2963B</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>Cus ID # </em></td><td align="left"><strong>C60236</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>Invoice #</em></td><td align="left"><strong>DE-60310</strong></td>
                    </tr>
                    <tr>
                        <td align="right"><em>Date</em></td><td align="left"><strong>01/30/2015</strong></td>
                    </tr>
                </table>
                </td>
            </tr>
        </table>
        -->
        <table class="calc_table" cellspacing="0" cellpadding="0"  width="100%">
            <tbody class="calc_header">
                <tr>
                    <td align="center" height="35" valign="top"><em>New/Used</em><br />
                        <strong><apex:outputText value="{! IF(OR(dealer__Deal__c.Vehicle_Source__c='Customer Owned',BEGINS(dealer__Deal__c.dealer__Deal_Type__c, 'Equipment')),'Cust. Owned',dealer__Deal__c.dealer__Vehicle__r.New_Used_Other__c )}" /></strong>
                    </td>

                    <td align="center" colspan="1" valign="top"><em>Make</em><br />
                    <strong><apex:outputText value="{! IF(OR(dealer__Deal__c.Vehicle_Source__c='Customer Owned',BEGINS(dealer__Deal__c.dealer__Deal_Type__c, 'Equipment')),dealer__Deal__c.dealer__Service_Vehicle__r.dealer__Make__c,dealer__Deal__c.dealer__Vehicle__r.dealer__Make__c ) }" /></strong>
                    </td>

                    <td align="center" colspan="2" valign="top"><em>Model</em><br />
                    <strong><apex:outputText value="{! IF(OR(dealer__Deal__c.Vehicle_Source__c='Customer Owned',BEGINS(dealer__Deal__c.dealer__Deal_Type__c, 'Equipment')),dealer__Deal__c.dealer__Service_Vehicle__r.dealer__Carline__c,dealer__Deal__c.dealer__Vehicle__r.dealer__Model__c ) }" /></strong>
                    </td>

                    <td align="center" valign="top" width="80px"><em>Year</em><br />
                    <strong><apex:outputText value="{! IF(OR(dealer__Deal__c.Vehicle_Source__c='Customer Owned',BEGINS(dealer__Deal__c.dealer__Deal_Type__c, 'Equipment')),dealer__Deal__c.dealer__Service_Vehicle__r.dealer__Year__c,dealer__Deal__c.dealer__Vehicle__r.dealer__Year__c ) }" /></strong>
                    </td>

                    <td align="center"  valign="top" width="100px"><em>Color</em><br />
                    <strong><apex:outputText value="{! IF(OR(dealer__Deal__c.Vehicle_Source__c='Customer Owned',BEGINS(dealer__Deal__c.dealer__Deal_Type__c, 'Equipment')),dealer__Deal__c.dealer__Service_Vehicle__r.dealer__Ext_Color__c , NULLVALUE(dealer__Deal__c.dealer__Vehicle__r.dealer__Exterior_Color__c,dealer__Deal__c.dealer__Exterior_Color__c) ) }" /></strong><!-- BLL14c -->
                    </td>

                    <td align="center" colspan="3" valign="top" width="60px"><em>To Be Delivered On Or About</em><br />
                        <strong>
                            <apex:OutputText value="{0, date, MM'/'dd'/'yyyy}">
                                <apex:param value="{!dealer__Deal__c.Proposed_Delivery_Date__c}" />
                            </apex:OutputText>
                        </strong>
                    </td>
                </tr>
                <tr>
                    <td align="center" height="35"><em>Type of Vehicle</em><br />
                        <strong><apex:outputText value="{! IF(OR(dealer__Deal__c.Vehicle_Source__c='Customer Owned',BEGINS(dealer__Deal__c.dealer__Deal_Type__c, 'Equipment')),dealer__Deal__c.dealer__Service_Vehicle__r.dealer__Body_Type__c,dealer__Deal__c.dealer__Vehicle__r.Unit_Type__c )}" /></strong>
                    </td>

                    <td align="center" colspan="3"><em>VIN</em><br />
                        <strong><apex:outputText value="{! IF(OR(dealer__Deal__c.Vehicle_Source__c='Customer Owned',BEGINS(dealer__Deal__c.dealer__Deal_Type__c, 'Equipment')),dealer__Deal__c.dealer__Service_Vehicle__r.dealer__VIN__c,dealer__Deal__c.dealer__Vehicle__r.dealer__VIN__c )}" /></strong>
                    </td>

                    <td align="center"><em>Mileage</em><br />
                        <strong><apex:outputText value="{! IF(OR(dealer__Deal__c.Vehicle_Source__c='Customer Owned',BEGINS(dealer__Deal__c.dealer__Deal_Type__c, 'Equipment')),dealer__Deal__c.dealer__Mileage__c,dealer__Deal__c.dealer__Mileage__c )}" /></strong>

                    </td>

                    <td align="center" colspan="9">
                    </td>
                </tr>
            </tbody>

            <apex:variable var="tot" value="{!0}" />

            <tbody class="calc_body">
                <apex:outputText rendered="{!NOT(ISBLANK(dealer__Deal__c.Chassis_Price__c))}">
                <tr>
                    <td colspan="8" class="lines">
                        <strong>Chassis Price: </strong>
                    </td>
                    <td align="right" class="lines">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.Chassis_Price__c}" />
                    </td>
                </tr>
                </apex:outputText>
                <tr>
                    <td colspan="8" class="lines">
                        <strong>Conversion/Add Equipment Price: </strong>
                    </td>
                    <td align="right" class="lines">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!dealer__Deal__c.Conversion_Price__c}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.Conversion_Price__c}" />
                    </td>
                </tr>

                <tr>
                    <td colspan="8" class="lines">
                        <strong>Adaptive Equipment (See Page 2 for detail): </strong>
                    </td>
                    <td align="right" class="lines">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.Total_Additional_Equipment__c}" />
                    </td>
                </tr>

                <tr>
                    <td colspan="8" class="lines">
                        <strong>Protection Products: </strong>
                    </td>
                    <td align="right" class="lines">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.Total_Protection_Products__c}" />
                    </td>
                </tr>
                <!-- <apex:repeat var="equip" value="{!selectedKits}">
                <tr>
                    <td colspan="8" class="lines">
                        <strong><apex:outputText value="{!equip.Name}" /></strong> &nbsp; 
                        <apex:outputText value="{!equip.dealer__Description__c}" />
                    </td>
                    <td align="right" class="lines">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!equip.dealer__Sale_Price__c}" />
                         </apex:outputText>
                    </td>
                </tr>
                </apex:repeat> -->
                <tr>
                    <td colspan="5">Discount Reason: <apex:outputText value="{!dealer__Deal__c.Conversion_Discount_Reason__c}" /></td>
                    <td class="border_left text_right" colspan="3" > 
                        <em> 
                            Discount
                        </em>
                    </td>
                    <td align="right">
                        <apex:outputText value="({0, number, currency})">
                               <apex:param value="{!0}" />
                             <apex:variable var="tot" value="{!tot - dealer__Deal__c.Conversion_Discount__c}" />
                        </apex:outputText>
                    </td>
                </tr>
                
                <tr><!-- row 1 -->
                    <!-- -->
                    <td colspan="5" rowspan="14">
                        <table width="100%">
                        <apex:repeat var="esc" value="{!soldOnProposal}">
                        <!--
                        <tr style="vertical-align: top;">
                            <td style="vertical-align: top; border-right:0px !important;">
                                Additional Protection: <apex:outputText value="{!esc.Name}" /> &nbsp; <apex:outputText value="{!esc.dealer__Description__c}" />
                            </td>
                            <td align="right">
                                <apex:outputText value="{0, number, currency}">
                                       <apex:param value="{!0}" />
                                 </apex:outputText>
                            </td>
                        </tr>
                        -->
                        </apex:repeat>
                        </table>
                    </td>
                        <td class="border_left text_right" colspan="3" > 
                            <em> 
                                MBW Rewards
                            </em>
                        </td>
                        <td align="right">
                            <apex:outputText value="({0, number, currency})">
                                <apex:param value="{!0}" />
                                <apex:variable var="tot" value="{!0}" />
                            </apex:outputText>
                        </td>
                    </tr>
                    <tr>
                    <!-- -->
                    <td class="text_right border_left" colspan="3" ><strong>Total</strong></td>
                    <td class="text_right" style="border-top:1px;">
                        <strong><apex:outputText value="{0, number, currency}">
                               <!-- <apex:param value="{!dealer__Deal__c.Chassis_Price__c + dealer__Deal__c.Conversion_Price__c + dealer__Deal__c.Total_Additional_Equipment__c + dealer__Deal__c.Total_Protection_Products__c - dealer__Deal__c.Conversion_Discount__c - dealer__Deal__c.MBW_Rewards__c}" /> -->
                               <apex:param value="{!0}" />
                        </apex:outputText></strong>
                    </td>
                </tr>
                <tr><!-- row 2 -->
                    <td class="border_left text_right" colspan="3" width="100"><em>Documentation Fee</em></td>
                    <td align="right">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.dealer__Doc_Fee__c}" />
                    </td>
                </tr>
                <tr><!-- row 3 -->
                    <td class="border_left text_right" colspan="3"  ><em>License Fee</em></td>
                    <td align="right">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.dealer__License_Fee__c}" />
                    </td>
                </tr>
                <tr><!-- row 4 -->
                    <td class="border_left text_right" colspan="3"  ><em>Registration Fee</em></td>
                    <td align="right">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.Registration_Title_Fee__c}" />
                    </td>
                </tr>
                <tr><!-- row 5 -->
                    <td class="border_left text_right" colspan="3"  ><em>Smog Cert.</em></td>
                    <td align="right">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.Smog_Cert__c}" />
                    </td>
                </tr> 
                <tr><!-- row 6 -->
                    <td class="border_left text_right" colspan="3"  ><em>Smog Fee</em></td>
                    <td align="right">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                          <apex:variable var="tot" value="{!tot+dealer__Deal__c.Smog_Fee__c}" />
                    </td>
                </tr>
                <tr><!-- row 7 -->
                    <td class="border_left text_right" colspan="3"  ><em>Tire Fee</em></td>
                    <td align="right">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                          <apex:variable var="tot" value="{!tot+dealer__Deal__c.Tire_Fee__c}" />
                    </td>
                </tr>
                <tr><!-- row 8 -->
                    <td class="border_left text_right" colspan="3"  ><em>Electronic Filing Fee</em></td>
                    <td align="right">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.Electronic_Filing_Fee__c}" />
                    </td>
                </tr>
                <tr><!-- row 9 -->
                    <td class="border_left text_right" colspan="3" ><em>Sales Tax&nbsp;&nbsp;&nbsp;&nbsp; </em></td>
                    <td class="text_right">
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot+dealer__Deal__c.dealer__Sales_Tax__c}" />
                    </td>
                </tr>
                <tr><!-- row 10 -->
                    <td class="border_left text_right" colspan="3" ><strong>Total Cash Delivered Price</strong></td>
                    <td class="text_right">
                        <strong><apex:outputText value="{0, number, currency}">
                               <!-- <apex:param value="{!dealer__Deal__c.dealer__Sales_Tax__c+dealer__Deal__c.Electronic_Filing_Fee__c+dealer__Deal__c.Smog_Fee__c + dealer__Deal__c.Tire_Fee__c+dealer__Deal__c.Smog_Cert__c+dealer__Deal__c.Registration_Title_Fee__c + dealer__Deal__c.dealer__License_Fee__c+dealer__Deal__c.dealer__Doc_Fee__c+dealer__Deal__c.Chassis_Price__c + dealer__Deal__c.Conversion_Price__c + dealer__Deal__c.Total_Additional_Equipment__c + dealer__Deal__c.Total_Protection_Products__c}" /> -->
                            <apex:param value="{!0}" />

                        </apex:outputText></strong>
                    </td>
                </tr>
                <tr><!-- row 11 -->
                    <td class="border_left text_right" colspan="3" > 
                        <em> 
                            Rebate(s)
                        </em>

                    </td>
                    <td align="right">

                        <apex:variable var="tot" value="{!tot-dealer__Deal__c.dealer__Rebate__c}" />
                        <apex:variable var="tot" value="{!tot-dealer__Deal__c.Rebate_2__c}" />
                        <apex:variable var="tot" value="{!tot-dealer__Deal__c.Rebate_3__c}" />
                        <apex:variable var="tot" value="{!tot-dealer__Deal__c.MFG_Rebate__c}" />
                        <apex:variable var="mmrebate" value="{!dealer__Deal__c.dealer__Rebate__c+dealer__Deal__c.Rebate_2__c+dealer__Deal__c.Rebate_3__c+dealer__Deal__c.MFG_Rebate__c}" />
                        <apex:outputText value="({0, number, currency})">
                               <apex:param value="{!0}" />
                        </apex:outputText>
                    </td>
                </tr>
                <tr><!-- row 12 -->
                    <td class="border_left text_right" colspan="3" > 
                        <em> 
                            Grant - (4502)
                        </em>
                        
                    </td>
                    <td align="right">
                        <apex:outputText value="({0, number, currency})">
                               <apex:param value="{!dealer__Deal__c.AutoGrant__c}" />
                        </apex:outputText>
                         <apex:variable var="tot" value="{!tot-dealer__Deal__c.AutoGrant__c}" />
                        
                    </td>
                </tr>

                <tr><!-- row 13 -->
                    <td class="border_left text_right" colspan="3"  >
                    <em>Third Party Payor</em>
                    </td>
                    <td align="right">
                        <apex:variable var="dd_down" value="{!dealer__Deal__c.dealer__Deferred_Down_1__c+dealer__Deal__c.dealer__Deferred_Down_2__c+dealer__Deal__c.dealer__Deferred_Down_3__c}" />
                        <apex:outputText value="({0, number, currency})">
                               <apex:param value="{!dd_down}" />
                        </apex:outputText>     
                        <apex:variable var="tot" value="{!tot - dd_down }" />

                    </td>
                </tr>

                <tr><!-- row 14 -->
                    <td align="center" colspan="4" rowspan="3"><!-- Cash --></td>
                    <td align="center"><em>Cash Down</em></td>
                    <td align="center"><em>Check/PO</em></td>

                    <td colspan="2" ><em> - </em></td>
                    <td align="right"> - </td>
                </tr>
                <tr><!-- row 15 -->
                    <td class="border_left" align="center"><em>Payment</em></td>
                    <td colspan="3" ><em>Deposit Amount + Cash Down Payment</em></td>
                    <td align="right">
                        <apex:outputText value="({0, number, currency})" rendered="{!NOT(ISBLANK(dealer__Deal__c.dealer__Deposit__c))}">
                               <apex:param value="{!0}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot - dealer__Deal__c.dealer__Deposit__c - dealer__Deal__c.dealer__Down_Pymt__c}" />
                    </td>
                </tr>
                <tr><!-- row 16 -->
                    <td ></td>
                    <td colspan="3" class="text_right"><strong>Total Credits</strong></td>
                    <td align="right">
                        <strong><apex:outputText value="({0, number, currency})" rendered="{!NOT(ISBLANK(dealer__Deal__c.dealer__Down_Pymt__c))}">
                               <apex:param value="{!0}" />
                         </apex:outputText> </strong>
                         <!-- <apex:variable var="tot_credits" value="{!dealer__Deal__c.dealer__Down_Pymt__c + dealer__Deal__c.dealer__Deposit__c  + dealer__Deal__c.dealer__Deferred_Down_1__c + dealer__Deal__c.dealer__Deferred_Down_2__c + dealer__Deal__c.dealer__Deferred_Down_3__c + dealer__Deal__c.AutoGrant__c + dealer__Deal__c.dealer__Rebate__c + dealer__Deal__c.Rebate_2__c + dealer__Deal__c.Rebate_3__c}" /> -->

                    </td>
                </tr>

                <tr>
                    <td class="center" colspan="8" style="border-top: 1px;"><strong>Trade-In(s)</strong></td>
                    <td style="border-top:1px;">
                    </td>
                </tr>


                <apex:repeat var="t" value="{!tradeInList}" >
                <!--
                <tr>
                    <td height="30" class="center" valign="top"><em>Year</em><br />
                        <apex:outputText value="{!t.dealer__Year__c}" />
                    </td>
                    <td height="30" class="center" valign="top"><em>Make</em><br />
                        <apex:outputText value="{!t.dealer__Make__c}" />
                    </td>

                    <td height="30" class="center" valign="top"><em>Model</em><br />
                        <apex:outputText value="{!t.dealer__Model__c}" />
                    </td>

                    <td height="30" class="center" valign="top" colspan="2"><em>Vin</em><br />
                        <apex:outputText value="{!t.dealer__VIN__c}" />
                    </td>
                    <td height="30" class="center" valign="top"><em>Payoff Amount</em><br />
                        <apex:outputText value="{!t.dealer__Pay_Off_Amount__c}" />
                    </td>
                    <td height="30" class="center" valign="top" colspan="2"><em>Allowance</em><br />
                        <apex:outputText value="{!t.dealer__Trade_Allowance__c}" />
                    </td>
                    <td height="30" class="border_left" valign="bottom" align="right" >
                        <apex:outputText value="({0, number, currency})" rendered="{!NOT(ISBLANK(t.Net_Value__c))}">
                               <apex:param value="{!t.Net_Value__c}" />
                         </apex:outputText>
                         <apex:variable var="tot" value="{!tot-t.Net_Value__c}" />
                     </td>
                </tr>
                -->
                </apex:repeat>
                <tr>
                    <td class="disclaimer" colspan="5" height="40">ONLY THOSE ITEMS AND SERVICES SPECIFICALLY WRITTEN ON THIS ORDER ARE INCLUDED IN THE STATED PRICE. ANY OTHER AGREEMENTS, UNLESS IN WRITING, ARE NOT BINDING ON SELLER.</td>
                    <td class="text_right" colspan="3" style="font-weight: bold"><strong>Amount Due Upon Delivery</strong></td>
                    <td class="text_right" width="100">
                    <strong>   
                        <!-- Due At Delivery -->
                        <apex:outputText value="{0, number, currency}">
                               <apex:param value="{!dealer__Deal__c.AutoGrant__c+dd_down}" />
                         </apex:outputText>
                    </strong>
                    </td>
                </tr>
            </tbody>
        </table>


        <table  width="100%">
            <tr>
                <td colspan="3" class="disclaimer">The first and second pages of this Order comprise the entire agreement affecting this purchase and no other agreement or understanding of any nature concerning this purchase has been made or entered into, or will be recognized. I hereby certify that no credit has been extended to me for the purchase of this motor vechicle except as appears in writing on the face of this a greement.<br />
                I have read and understand the second page of this agreement and agree to it as a part of this order the same as if it were printed above my signature.I certify that I am of legal age, or older, that I have legal capacity and authority to execute this agreement on behalf of my company, and hereby ack nowledge receipt of a copy of this order.</td>
            </tr>
            <tr>
                <td style=" text-align:center; border-bottom:2px black;" width="47%">{!dealer__Deal__c.dealer__Buyer__r.Name}</td>
                <td width="10%">
                </td>
                <td style=" text-align:center; border-bottom:2px black;" width="47%">{!dealer__Deal__c.dealer__Salesperson_1__r.Name}</td>
            </tr>
            <tr>
                <td height="40" style="font-size: 0.8em; text-align: center" valign="top" width="47%"><em>Purchaser's Name</em></td>
                <td height="40" width="10%">
                </td>
                <td height="40" style="font-size: 0.8em; text-align: center" valign="top" width="47%"><em>Sales Person</em></td>
            </tr>
            <tr>
                <td height="40" style="border-top: 1px black solid; font-size: 0.8em; text-align: center" valign="top" width="50%"><em>Purchaser's Signature</em></td>
                <td height="40">
                </td>
                <td height="40" style=" text-align:center; border-top:1px black solid;" width="50%"><em>Approved By:</em>
                </td>
            </tr>
            <tr>
                <td style=" text-align:center; border-bottom:0px black;" width="47%"></td>
                <td width="10%"> </td>
                <td style=" text-align:center; border-bottom:0px black;" width="47%"></td>
            </tr>
            <tr>
                <td height="40" style="border-top: 1px black solid; font-size: 0.8em; text-align: center" valign="top" width="50%"><em>Co-Purchaser's Signature</em>
                &nbsp;&nbsp;{!dealer__Deal__c.dealer__Co_Buyer__r.Name}
                </td>
                <td height="40">  </td>
                <td height="40" style=" text-align:center; border-top:0px black solid;" width="50%">  </td>
            </tr>
            
            <tr><td colspan="3" class="disclaimer"><em>This order is not valid unless signed and accepted by dealer</em></td></tr>
        </table>
    </div>
</body>
</html>
</apex:page>